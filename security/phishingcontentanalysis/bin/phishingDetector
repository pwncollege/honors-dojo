#!/usr/bin/exec-suid -- /usr/local/bin/python -I

import os
import sys

LEGIT_FILE = "/home/hacker/legitimate_metamask.html"
PHISHING_FILE = "/home/hacker/phishing_metamask.html"

def setup_files():
    """Create HTML files on first run."""
    if not os.path.exists(LEGIT_FILE) or not os.path.exists(PHISHING_FILE):
        # Get flag
        try:
            with open("/flag", 'r') as f:
                flag = f.read().strip()
        except FileNotFoundError:
            flag = "pwn.college{demo_phishing_flag}"

        # Create legitimate file
        with open(LEGIT_FILE, 'w') as f:
            f.write('''<!DOCTYPE html>
<html>
<head>
    <title>MetaMask - Confirm Transaction</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f6f6f6; margin: 0; padding: 20px; }
        .container { max-width: 400px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .logo { color: #f6851b; font-size: 28px; font-weight: bold; margin-bottom: 10px; }
        .fox-icon { font-size: 40px; margin-bottom: 15px; }
        h2 { margin: 20px 0; color: #24292e; }
        .tx-details { margin: 25px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .label { color: #6a737d; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }
        .value { font-size: 18px; font-weight: 600; margin: 8px 0 15px 0; color: #24292e; word-break: break-all; }
        .confirm-btn { background: #f6851b; color: white; padding: 16px; width: 100%; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        .confirm-btn:hover { background: #e47316; }
    </style>
</head>
<body>
    <div class="container">
        <div class="fox-icon">ðŸ¦Š</div>
        <div class="logo">MetaMask</div>
        <h2>Confirm Transaction</h2>

        <div class="tx-details">
            <div class="label">FROM</div>
            <div class="value">0x1a2b3c4d5e6f7890abcdef1234567890abcdef12</div>
        </div>

        <div class="tx-details">
            <div class="label">TO</div>
            <div class="value">0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb</div>
        </div>

        <div class="tx-details">
            <div class="label">AMOUNT</div>
            <div class="value">1.5 ETH</div>
        </div>

        <div class="tx-details">
            <div class="label">GAS FEE (ESTIMATED)</div>
            <div class="value">0.002 ETH</div>
        </div>

        <div class="tx-details">
            <div class="label">TOTAL</div>
            <div class="value">1.502 ETH</div>
        </div>

        <button class="confirm-btn">Confirm</button>
    </div>
</body>
</html>''')

        # Create phishing file with flag embedded in the wallet address
        with open(PHISHING_FILE, 'w') as f:
            f.write(f'''<!DOCTYPE html>
<html>
<head>
    <title>MetaMask - Confirm Transaction</title>
    <style>
        body {{ font-family: Arial, sans-serif; background: #f6f6f6; margin: 0; padding: 20px; }}
        .container {{ max-width: 400px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }}
        .logo {{ color: #f6851b; font-size: 28px; font-weight: bold; margin-bottom: 10px; }}
        .fox-icon {{ font-size: 40px; margin-bottom: 15px; }}
        h2 {{ margin: 20px 0; color: #24292e; }}
        .tx-details {{ margin: 25px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; }}
        .label {{ color: #6a737d; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }}
        .value {{ font-size: 18px; font-weight: 600; margin: 8px 0 15px 0; color: #24292e; word-break: break-all; }}
        .confirm-btn {{ background: #f6851b; color: white; padding: 16px; width: 100%; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px; }}
        .confirm-btn:hover {{ background: #e47316; }}
    </style>
</head>
<body>
    <div class="container">
        <div class="fox-icon">ðŸ¦Š</div>
        <div class="logo">MetaMask</div>
        <h2>Confirm Transaction</h2>

        <div class="tx-details">
            <div class="label">FROM</div>
            <div class="value">0x1a2b3c4d5e6f7890abcdef1234567890abcdef12</div>
        </div>

        <div class="tx-details">
            <div class="label">TO</div>
            <div class="value">0xDEADBEEF_PHISHING_{flag}</div>
        </div>

        <div class="tx-details">
            <div class="label">AMOUNT</div>
            <div class="value">1.5 ETH</div>
        </div>

        <div class="tx-details">
            <div class="label">GAS FEE (ESTIMATED)</div>
            <div class="value">0.002 ETH</div>
        </div>

        <div class="tx-details">
            <div class="label">TOTAL</div>
            <div class="value">1.502 ETH</div>
        </div>

        <button class="confirm-btn">Confirm</button>
    </div>
</body>
</html>''')

        print(f"Files created:")
        print(f"  - {LEGIT_FILE}")
        print(f"  - {PHISHING_FILE}")
        print("\nUse 'diff' to compare them and find the phishing address:")
        print(f"  diff {LEGIT_FILE} {PHISHING_FILE}")
        print("\nOr filter to see only the changed line:")
        print(f"  diff {LEGIT_FILE} {PHISHING_FILE} | grep '>'")
        sys.exit(0)

def check_files_exist():
    """Verify both files exist."""
    if not os.path.exists(LEGIT_FILE) or not os.path.exists(PHISHING_FILE):
        print("Error: Phishing detection files not found")
        print("\nRun this command again to create them")
        return False
    return True

def main():
    setup_files()
    if not check_files_exist():
        sys.exit(1)
    
    # Files exist, just provide instructions
    print("âœ“ Files already exist")
    print("\nUse diff to compare the files and find the malicious wallet address:")
    print(f"  diff {LEGIT_FILE} {PHISHING_FILE}")

if __name__ == "__main__":
    main()
