#!/usr/bin/exec-suid -- /usr/local/bin/python -I

import os
import sys

def setup_environment():
    """Set up the environment variable with the exposed private key."""
    # Try to read the flag
    try:
        with open("/flag", 'r') as f:
            flag_content = f.read().strip()
    except FileNotFoundError:
        flag_content = "pwn.college{DEMO_FLAG_WOULD_APPEAR_HERE}"

    # Create the private key with embedded flag
    private_key = f"0x1234567890abcdef_{flag_content}"

    # Export to current environment
    os.environ['WALLET_PRIVATE_KEY'] = private_key

    print("="*60)
    print("THE HOT WALLET EXPOSURE - Challenge Setup")
    print("="*60)
    print("\nA developer has carelessly exposed a wallet private key!")
    print("The WALLET_PRIVATE_KEY environment variable has been set.")
    print("\n" + "⚠️  "*20)
    print("\n" + "="*60)
    print("YOUR TASK")
    print("="*60)
    print("\nUse grep to search through the environment variables")
    print("and locate the exposed WALLET_PRIVATE_KEY.")
    print("\nHints:")
    print("  • Use the 'env' command to list all environment variables")
    print("  • Pipe the output to 'grep' to search for patterns")
    print("  • Try: env | grep WALLET")
    print("\nThe flag is embedded in the private key value.")
    print("\n" + "="*60)
    print("SECURITY REMINDER")
    print("="*60)
    print("\nNever store private keys in environment variables!")
    print("\nThey are visible to:")
    print("  • All child processes")
    print("  • System logs and debugging output")
    print("  • Process listings (ps aux -e)")
    print("  • /proc filesystem (/proc/PID/environ)")
    print("  • Error messages and stack traces")
    print("\n" + "⚠️"*30)
    print("\nUse proper secret management instead:")
    print("  ✓ Hardware wallets (Ledger, Trezor)")
    print("  ✓ Secret management tools (HashiCorp Vault, AWS Secrets Manager)")
    print("  ✓ Encrypted configuration files with restricted permissions")
    print("  ✓ Cold storage for long-term holdings")
    print("\nReal-world impact:")
    print("  • Coinbase lost $3M due to exposed API keys in logs")
    print("  • Multiple DeFi protocols hacked via environment variable leaks")
    print("  • Private keys in Docker logs led to wallet drains")
    print("\n" + "="*60)

def main():
    """Main setup logic."""
    setup_environment()

if __name__ == "__main__":
    main()
